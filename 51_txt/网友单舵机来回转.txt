      /****************************************************************
			实验 :舵机用虚拟PWM波驱动
			单片机 STC89C52RC
			晶振 : 11.0592
			实验结果 180度能有40个位置停留
			QQ : 1415222053
			*****************************************************************/
			#include <reg52.h>
      
                        sbit pwm =P1^0 ;
			unsigned char jd;
			unsigned int count;
			unsigned int j_0;
      //声明函数			
     // void Time0_Init();         
     // void angle_4_5(unsigned char angle);
     // void angle(unsigned char angle_0);

			void Time0_Init() //打开定时器和中断         
      {
	  TMOD &= 0xF0;
      TMOD = 0x01;             
			EA = 1;
			ET0 = 1;
      TH0  = 0xFE;
      TL0  = 0xFC;     //11.0592
      TR0=1;                
      }
		/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	
			void Time0_Int() interrupt 1 //利用中断虚拟产生一个20us PWM波
      {
      TH0  = 0xFF;             
      TL0  = 0xFE;               
      if(count <= jd)              
      pwm=1;                  
      else
      pwm=0;                 
      count=（count+1); 
      if(count >= 460)
      count = 0;
      }
			////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
			void angle_4_5(unsigned char angle)//从右极限往左极限转过的角度= angle * 4.5
			{
				jd = angle;  
				for(j_0 = 0;j_0 <=8000;j_0++);
			}
			/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
			void angle(unsigned char angle_0)//右极限
			{
				jd = angle_0;  
				for(j_0 = 0;j_0 <= 8000;j_0++);
			}
			/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	
      void main()
      {
      count = 0;
      Time0_Init();             
      while(1)
			   {

			    angle_4_5(53); //从左极限向左转过的角度 = (angle-15) * 4.5 
			    angle(15);	

			   }
      }
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	
			